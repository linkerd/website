+++
title = "Automatic mTLS"
description = "Linkerd automatically enables mutual Transport Layer Security (TLS) for all communication between meshed applications."
weight = 4
aliases = [
  "/2/features/automatic-tls"
]
+++

By default, Linkerd automatically enables mutual Transport Layer Security
(mTLS) for most HTTP-based communication between meshed pods, by establishing
and authenticating secure, private TLS connections between Linkerd proxies.
Each proxy is issued a TLS certificate tied to the [Kubernetes Service
Account](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/)
of the pod in which it resides, which is periodically rotated. Because the
Linkerd control plane also runs on the data plane, this means that
communication between control plane components are also automatically secured
via mTLS.

Not all traffic can be automatically mTLS'd, but it's easy to [verify which
traffic is](/2/tasks/securing-your-service/). Please see [Caveats and future
work](#caveats-and-future-work) below for details on which traffic cannot
currently be automatically encrypted.

## How does it work?

Linkerd's automatic mTLS uses a set of credentials stored in the control
plane: a trust anchor and an issuer certificate and private key. These
credentials can be generated by Linkerd itself during install time, or can be
provided by an external source, e.g. [Vault](https://vaultproject.io) or
[cert-manager](https://github.com/jetstack/cert-manager).

The issuer certificate and private key are placed into a [Kubernetes
Secret](https://kubernetes.io/docs/concepts/configuration/secret/); by default,
the Secret is placed in the `linkerd` namespace and can only be read by the
service account used by the [Linkerd control
plane](/2/reference/architecture/)'s `identity` component.

On the data plane side, at startup, each proxy generates a private key for
itself. This key is stored in a [tmpfs
emptyDir](https://kubernetes.io/docs/concepts/storage/volumes/#emptydir) which
stays in memory and never leaves the pod. After the key has been generated, the
proxy connects to the control plane's `identity` component, validating the
connection to `identity` with the trust anchor, which is provided to each proxy
container as an environment variable.

Once the proxy has connected to the `identity` control plane component, it
issues a [certificate signing request
(CSR)](https://en.wikipedia.org/wiki/Certificate_signing_request). The CSR
contains an initial certificate with the pod's identity set to its
ServiceAccount, and the actual service account token, so that `identity` can
validate that the CSR is valid. Once validation has succeeded, the signed trust
bundle is returned to the proxy, which can use it as both a client and server certificate.

These certificates are scoped to 24 hours and will be dynamically refreshed
using the same mechanism.

## Caveats and future work

There are several known gaps in Linkerd's ability to automatically encrypt and
authenticate all communication in the cluster. These gaps will be fixed in
future releases:

* Non-HTTP traffic is not currently automatically TLS'd. This will be
  addressed in a future Linkerd release.

* HTTP requests where the `Host` header is an IP address, rather than a name,
  are currently not automatically TLS'd. For example, the connections that
  Linkerd's Prometheus control plane component uses to scrape proxy metrics are
  not currently automatically TLS'd. This will be addressed in a future Linkerd
  release.

* Linkerd does not currently *enforce* mTLS. Any unencrypted requests inside
  the mesh will be opportunistically upgraded to mTLS. Any requests originating
  from inside or outside the mesh will not be automatically mTLS'd by Linkerd.
  This will be addressed in a future Linkerd release, likely as an opt-in
  behavior as it may break some existing applications.

* Ideally, the Service Account token that Linkerd uses would not be shared with
  other potential uses of that token. In future Kubernetes releases, Kubernetes
  will support audience/time-bound Service Account tokens, and Linkerd will use
  those instead.
